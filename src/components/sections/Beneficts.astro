---
import Container from "../elements/Container.astro";
import Title from "../elements/Title.astro";
import data from "../../utils/data/benefictsData.json";
import CardBeneficts from "../elements/CardBeneficts.astro";
---

<section
  class="py-8 lg:py-14"
  id="carrousel"
>
  <Container className="xl:pl-14 pr-0 pl-0 md:pr-0 md:pl-0 xl:pr-0">
    <div
      class="w-full flex flex-row justify-center items-center overflow-hidden"
    >
      <div class="w-full mx-auto">
        <div
          id="scroll-container"
          class="overflow-scroll snap-mandatory snap-x whitespace-nowrap scrollbar-hide"
        >
          <div class="inline-flex px-4 gap-x-10">
            <div
              class="w-[calc(100vw-30px)] lg:w-[800px] h-[500px] flex justify-center items-center"
            >
              <div
                class="relative w-full h-[440px] flex flex-col justify-center items-start pl-10 gap-4 lg:gap-20 img__before overflow-hidden"
              >
                <span
                  data-aos="fade-right"
                  data-aos-duration="2000"
                  data-aos-once="true"
                >
                  <Title
                    title1="Beneficios de"
                    title2="Elegirnos"
                    description="PORQUE SAL Y SILVETTI"
                  />
                </span>

                <p
                  class="w-[55%] text-pretty text-sm md:text-base lg:text-lg"
                  data-aos="fade-left"
                  data-aos-duration="2000"
                  data-aos-once="true"
                >
                  Lorem ipsum dolor sit amet consectetur adipisicing elit.
                  Quaerat sed reiciendis incidunt officia architecto. Laboriosam
                  quam cum architecto, in expedita obcaecati optio quidem
                  adipisci, voluptate fuga ullam eligendi, dicta dolorum.
                </p>
              </div>
            </div>

            {
              data.map((item) => (
                <div
                  class="w-[calc(100vw-100px)] lg:w-[800px] h-[500px] flex justify-center items-center"
                  data-aos="fade-left"
                  data-aos-duration="2000"
                  data-aos-once="true"
                >
                  <CardBeneficts {...item} />
                </div>
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </Container>
</section>

<style>
  .img__before::before {
    z-index: -2;
    content: "";
    position: absolute;
    top: -3%;
    left: 8%;
    width: 100%;
    height: 100%;
    background-image: url("../../../public/img/arrow.avif");
    background-repeat: no-repeat;
    background-size: 60% 60%;
    background-position: center;
    transform: rotate(350deg);
  }

  .img__before::after {
    z-index: -1;
    content: "";
    position: absolute;
    width: 100%;
    height: 100%;
    background-color: #f8f1ec;
    background-size: 100% 100%;
    background-position: center;
    transform: translateX(0);
    transition: transform 3s linear;
  }

  .img__before.animate::after {
    transform: translateX(100%);
  }

  .scrollbar-hide::-webkit-scrollbar {
    background-color: #c4c3c1;
    display: none;
  }
  .scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const carrousel = document.getElementById("carrousel");

    const observer = new IntersectionObserver(
      (entries, observer) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            const imgBefore = carrousel.querySelector(".img__before");
            if (imgBefore) {
              imgBefore.classList.add("animate");
            }

            observer.disconnect();
          }
        });
      },
      { threshold: 0.5 }
    );

    observer.observe(carrousel);

    const scrollContainer = document.getElementById("scroll-container");

    function handleWheel(e) {
      e.preventDefault();
      scrollContainer.scrollLeft += e.deltaY;

      const maxScrollLeft =
        scrollContainer.scrollWidth - scrollContainer.clientWidth;
      if (
        scrollContainer.scrollLeft === 0 ||
        scrollContainer.scrollLeft === maxScrollLeft
      ) {
        scrollContainer.removeEventListener("wheel", handleWheel);
        scrollContainer.addEventListener("wheel", handleWheelPassive, {
          passive: true,
        });
      }
    }

    function handleWheelPassive(e) {}

    function activateWheel() {
      scrollContainer.removeEventListener("wheel", handleWheelPassive);
      scrollContainer.addEventListener("wheel", handleWheel, {
        passive: false,
      });
    }

    function deactivateWheel() {
      scrollContainer.removeEventListener("wheel", handleWheel);
      scrollContainer.addEventListener("wheel", handleWheelPassive, {
        passive: true,
      });
    }

    scrollContainer.addEventListener("wheel", handleWheel, { passive: false });
    scrollContainer.addEventListener("mouseenter", activateWheel);
    scrollContainer.addEventListener("mouseleave", deactivateWheel);
  });
</script>
